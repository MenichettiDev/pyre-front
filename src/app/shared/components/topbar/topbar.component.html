<!-- TOPBAR MEJORADO CON BREADCRUMBS Y TÍTULO DINÁMICO -->
<nav class="topbar" [class.logged-in]="isLoggedIn && !isSmallScreen">
  <div class="topbar-container">

    <!-- Botón hamburguesa (móvil) -->
    <button
      *ngIf="isLoggedIn && isSmallScreen"
      class="btn-hamburger"
      (click)="toggleSidebar()"
      aria-label="Toggle sidebar">
      <i class="bi bi-list"></i>
    </button>

    <!-- SECCIÓN DE TÍTULO CON BREADCRUMBS -->
    <div class="topbar-title-section" [@titleChange]>
      <!-- Breadcrumbs (si existen) -->
      <nav *ngIf="hasBreadcrumbs && !isSmallScreen" class="breadcrumbs" aria-label="breadcrumb">
        <ol class="breadcrumb-list">
          <li
            *ngFor="let crumb of breadcrumbs; let last = last"
            class="breadcrumb-item"
            [@breadcrumbSlide]>

            <!-- Si tiene ruta, es clickeable -->
            <a
              *ngIf="crumb.route && !last"
              [routerLink]="crumb.route"
              class="breadcrumb-link">
              <i *ngIf="crumb.icon" [class]="'bi ' + crumb.icon + ' me-1'"></i>
              {{ crumb.label }}
            </a>

            <!-- Último elemento o sin ruta -->
            <span
              *ngIf="!crumb.route || last"
              class="breadcrumb-current"
              [class.active]="last">
              <i *ngIf="crumb.icon" [class]="'bi ' + crumb.icon + ' me-1'"></i>
              {{ crumb.label }}
            </span>

            <!-- Separador -->
            <i *ngIf="!last" class="bi bi-chevron-right breadcrumb-separator"></i>
          </li>
        </ol>
      </nav>

      <!-- Título Principal con Icono -->
      <div class="page-title-container">
        <div class="page-title-wrapper">
          <!-- Icono de la página -->
          <div *ngIf="pageIcon" class="page-icon" [class]="'text-' + pageColor">
            <i [class]="'bi ' + pageIcon"></i>
          </div>

          <!-- Título y Subtítulo -->
          <div class="page-title-content">
            <h1 class="page-title">
              {{ pageTitle }}

              <!-- Badge opcional (ej: notificaciones) -->
              <span
                *ngIf="pageBadge"
                class="badge ms-2"
                [class]="'bg-' + pageBadge.color">
                {{ pageBadge.text }}
              </span>
            </h1>

            <!-- Subtítulo (descripción breve) -->
            <p *ngIf="pageSubtitle && !isSmallScreen" class="page-subtitle">
              {{ pageSubtitle }}
            </p>
          </div>
        </div>
      </div>
    </div>

    <!-- SECCIÓN DE USUARIO (Derecha) -->
    <div class="topbar-user-section" *ngIf="isLoggedIn">

      <!-- Información del usuario (desktop) -->
      <div class="user-info" *ngIf="!isSmallScreen">
        <span class="user-pill" [ngbTooltip]="pillTooltip" placement="bottom">
          <i class="bi bi-person-badge me-1"></i>
          {{ displayLegajo || userLegajo }}
        </span>
        <span class="user-role-badge" *ngIf="displayRole">
          {{ displayRole }}
        </span>
      </div>

      <!-- Botón de logout (icono) -->
      <button class="logout-icon-btn" (click)="confirmLogout()" [ngbTooltip]="'Cerrar Sesión'" aria-label="Cerrar sesión" *ngIf="!isSmallScreen">
        <i class="bi bi-power"></i>
      </button>
    </div>
  </div>
</nav>
