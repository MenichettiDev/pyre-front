<link href="https://fonts.googleapis.com/css2?family=Nunito:wght@400&display=swap" rel="stylesheet">

<!-- Barra superior fija para todas las pantallas -->
<div class="top-bar" *ngIf="isLoggedIn">
    <!-- Layout para Desktop -->
    <div class="topbar-desktop" *ngIf="!isSmallScreen">
        <div class="topbar-center">
            <h4 class="app-title">Sistema de Gestión de Herramientas</h4>
        </div>

        <div class="topbar-right">
            <div class="user-info">
                <div class="user-email-pill" *ngIf="userEmail" title="{{ userEmail }}">
                    <i class="bi bi-envelope-fill email-icon"></i>
                    <span class="email-text">{{ displayEmail || 'Usuario' }}</span>
                </div>
                <span class="profile-toggle" (click)="togglePerfilModal()" title="Ver perfil y opciones">
                    <i class="bi bi-person-circle profile-icon"></i>
                </span>
                <!-- Dropdown de perfil -->
                <div class="profile-dropdown" *ngIf="isPerfilModalVisible">
                    <ul>
                        <li (click)="navigateToHome(); isPerfilModalVisible=false"><i class="bi bi-person me-2"></i> Perfil</li>
                        <li (click)="confirmLogout()"><i class="bi bi-box-arrow-right me-2"></i> Cerrar Sesión</li>
                    </ul>
                </div>
            </div>
        </div>
    </div>

    <!-- Layout para Mobile -->
    <div class="topbar-mobile" *ngIf="isSmallScreen">
        <div class="topbar-left">
            <div class="logo-small">
                <img src="assets/images/logos/logo.png" alt="Logo" (click)="navigateToHome()">
            </div>
            <div class="hamburger-menu" (click)="toggleSidebar()">
                <i class="bi bi-list"></i>
            </div>
        </div>

        <div class="topbar-center">
            <h4 class="app-title">Sistema de Gestión</h4>
        </div>

        <div class="topbar-right">
            <div class="user-info">
                <div class="user-email-pill" *ngIf="userEmail" title="{{ userEmail }}">
                    <i class="bi bi-envelope-fill email-icon"></i>
                    <span class="email-text">{{ displayEmail || '' }}</span>
                </div>
                <span class="profile-toggle" (click)="togglePerfilModal()" title="Ver perfil y opciones">
                    <i class="bi bi-person-circle profile-icon"></i>
                </span>
            </div>
        </div>
    </div>
</div>

<!-- Sidebar -->
<div *ngIf="isLoggedIn">
    <div class="sidebar" [ngClass]="{'hidden': !isSidebarVisible, 'visible': isSidebarVisible}">

        <!-- Logo -->
        <div class="sidebar-img">
            <img src="assets/images/logos/logo.png" alt="Logo" (click)="navigateToHome()">
        </div>

        <!-- Lista de menús principales -->
        <ul class="nav flex-column">
            <li *ngFor="let menu of visibleMenuItems" class="nav-item">
                <!-- Enlace del menú principal -->
                <a class="nav-link" (click)="toggleSubMenu(menu)">
                    <i class="{{ menu.icono }}"></i> <!-- Icono del menú principal -->
                    <span>{{ menu.descripcion }}</span>
                    <i class="arrow" [ngClass]="{'rotate': isMenuExpanded(menu)}"
                        *ngIf="getSubMenus(menu).length > 0"></i>
                </a>

                <!-- Submenús -->
                <ul [ngClass]="{'sub-menu': true, 'expanded': isMenuExpanded(menu)}"
                    *ngIf="getSubMenus(menu).length > 0">
                    <li *ngFor="let subMenu of getSubMenus(menu)" class="nav-item">
                        <a class="nav-link" [routerLink]="subMenu.link" routerLinkActive="active"
                            (click)="navigateToSubMenu(subMenu)">
                            <i class="{{ subMenu.icono }}" *ngIf="subMenu.icono"></i>
                            <span>{{ subMenu.descripcion }}</span>
                        </a>
                    </li>
                </ul>
            </li>
        </ul>

        <!-- Botón de Logout eliminado del sidebar: ahora en dropdown de perfil -->

        <!-- Antes se usaba un modal local; ahora se usa SweetAlert2 desde JS global -->
    </div>
</div>

<!-- El contenido principal se renderiza en <router-outlet> dentro de .main-wrapper -->
<!-- Eliminado el contenedor vacío .main-content para evitar que ocupe espacio y empuje las vistas -->
